# see
# https://docs.spring.io/spring-boot/docs/current/reference/html/common-application-properties.html
# for full list of options

# Deployment environment (DEV, TEST, PROD)
INATrace.env = DEV

# Product type for data initialization (COFFEE, COCOA)
INATrace.product.type = ${INATRACE_PRODUCT_TYPE:SHRIMP}

spring.main.banner-mode = off

# Server settings
server.forward-headers-strategy = framework
server.port = 8080
server.address=0.0.0.0

management.health.mail.enabled =  false

# To allow uploads of large files (images)
spring.servlet.multipart.max-file-size = 10MB

# increase async request timeout (in milliseconds) to avoid AsyncRequestTimeoutException
spring.mvc.async.request-timeout = 120000

# Disable default static resource handling (this is a pure API backend)
# Prevents NoResourceFoundException for non-existent API paths
spring.web.resources.add-mappings = false

# Springdoc
springdoc.default-produces-media-type = application/json

# DataSource settings
INATrace.database.name = ${INATRACE_DATABASE_NAME:inatrace}
INATrace.database.hostname = ${INATRACE_DATABASE_HOSTNAME:localhost}
INATrace.database.port = ${INATRACE_DATABASE_PORT:3306}

spring.datasource.url = ${SPRING_DATASOURCE_URL:jdbc:mysql://${INATrace.database.hostname}:${INATrace.database.port}/${INATrace.database.name}?autoReconnect=true&allowPublicKeyRetrieval=true&useSSL=false&serverTimezone=UTC}
spring.datasource.username = ${SPRING_DATASOURCE_USERNAME:root}
spring.datasource.password = ${SPRING_DATASOURCE_PASSWORD:root}
# spring.jpa.show-sql = true
spring.jpa.hibernate.ddl-auto = ${INATRACE_HIBERNATE_DDL_AUTO:validate}
spring.jpa.autocommit = true

# disable jmx to prevent exceptions by hikari connection pool on localhost
spring.jmx.enabled = false

# Logging configuration to reduce noise
logging.level.org.apache.coyote.http11.Http11Processor=ERROR
logging.level.org.springframework.web.servlet.resource.ResourceHttpRequestHandler=ERROR
logging.level.com.abelium.inatrace.security.configuration.TokenAuthenticationFilter=WARN
logging.level.org.springframework.web.reactive.function.client=WARN
logging.level.org.hibernate.orm.query=WARN
#logging.level.org.hibernate.SQL=DEBUG

# increase the maximum pool size and make in growable
spring.datasource.hikari.maximumPoolSize = 20
spring.datasource.hikari.minimumIdle = 10
spring.datasource.hikari.idleTimeout = 30000
# lower Hikari db pool lifetime to 30s to quickly recover after Aurora failover
spring.datasource.hikari.maxLifetime = 30000

# Hibernate naming strategies (fixes case with one class being embedded multiple times into same entity
spring.jpa.hibernate.naming.implicit-strategy = org.hibernate.boot.model.naming.ImplicitNamingStrategyComponentPathImpl
spring.jpa.hibernate.naming.physical-strategy = org.hibernate.boot.model.naming.PhysicalNamingStrategyStandardImpl
spring.jpa.properties.hibernate.dialect = com.abelium.inatrace.configuration.CustomMySQLDialect

# Create/update envers auditing tables
spring.jpa.properties.hibernate.hbm2ddl.auto = ${INATRACE_HIBERNATE_HBM2DDL_AUTO:validate}

# FlyWay (FlywayProperties)
spring.flyway.enabled = true
inatrace.flyway.custom = true
spring.flyway.baseline-on-migrate = ${INATRACE_FLYWAY_BASELINE_ON_MIGRATE:true}
spring.flyway.baseline-version = ${INATRACE_FLYWAY_BASELINE_VERSION:0}
spring.flyway.out-of-order = ${INATRACE_FLYWAY_OUT_OF_ORDER:true}
spring.flyway.validate-on-migrate = ${INATRACE_FLYWAY_VALIDATE_ON_MIGRATE:true}
spring.flyway.check-location = false
spring.flyway.table = schema_version
spring.flyway.ignore-migration-patterns = ${INATRACE_FLYWAY_IGNORE_MIGRATION_PATTERNS:*:missing}
spring.flyway.locations = com.abelium.inatrace.db.migrations,classpath:/db/migrations

spring.jackson.serialization.write-dates-as-timestamps = false
spring.jackson.serialization.write-date-timestamps-as-nanoseconds = false
spring.jackson.deserialization.read-date-timestamps-as-nanoseconds = false
spring.jackson.default-property-inclusion=non_null

# to avoid warning in thymeleaf 3
spring.thymeleaf.mode = HTML

# set to true in production
spring.thymeleaf.cache = false 

# SMTP settings
spring.mail.protocol = smtp
spring.mail.host = ${SPRING_MAIL_HOST:}
spring.mail.port = ${SPRING_MAIL_PORT:465}
spring.mail.username = ${SPRING_MAIL_USERNAME:}
spring.mail.password = ${SPRING_MAIL_PASSWORD:}
spring.mail.properties.mail.smtp.auth = ${SPRING_MAIL_SMTP_AUTH:true}
spring.mail.properties.mail.smtp.ssl.enable = ${SPRING_MAIL_SMTP_SSL_ENABLE:true}
spring.mail.properties.mail.smtp.starttls.enable = ${SPRING_MAIL_STARTTLS_ENABLE:false}
# prevent hanging on unresponsive server
spring.mail.properties.mail.smtp.connectiontimeout = ${SPRING_MAIL_SMTP_CONNECTION_TIMEOUT:5000}
spring.mail.properties.mail.smtp.timeout = ${SPRING_MAIL_SMTP_TIMEOUT:3000}
spring.mail.properties.mail.smtp.writetimeout = ${SPRING_MAIL_SMTP_WRITETIMEOUT:5000}
# set to true to log smtp server requests/responses
spring.mail.properties.mail.debug = ${SPRING_MAIL_DEBUG:false}

# mail template properties
INATrace.mail.template.from = ${INATRACE_MAIL_TEMPLATE_FROM:no-reply@inatrace.com}

INATrace.mail.redirect = ${INATRACE_MAIL_REDIRECT:}

# if sending mail is enabled
INATrace.mail.sendingEnabled = ${INATRACE_MAIL_SENDING_ENABLED:false}

# mail to send when a new registration is requested
INATrace.loginManager.mail = ${INATRACE_LOGINMANAGER_MAIL:desarrollo@atijaguar.com}

# info email
INATrace.info.mail = ${INATRACE_INFO_MAIL:desarrollo@atijaguar.com}

# Tokens name and expiration
INATrace.auth.accessTokenCookieName = inatrace-accessToken
INATrace.auth.accessTokenExpirationSec = 3600
INATrace.auth.refreshTokenCookieName = inatrace-refreshToken
INATrace.auth.refreshTokenExpirationSec = 300
INATrace.auth.jwtSigningKey = efdsfsd2342343sdffew

# path to import resources (e.g. in migrations to fill tables)
INATrace.import.path = ${INATRACE_IMPORT_PATH:import/}

# path to other documents
INATrace.documents.root = ${INATRACE_DOCUMENTS_ROOT:/opt/inatrace/documents}

# file storage location (local path)
INATrace.fileStorage.root = ${INATRACE_FILESTORAGE_ROOT:/opt/inatrace/uploads}

# url (prefix) for email confirmation after registration
INATrace.emailConfirmation.url = ${INATRACE_EMAILCONFIRMATION_URL:https://localhost:4200/confirm-email?token=}

# url (prefix) for password reset
INATrace.passwordReset.url = ${INATRACE_PASSWORDRESET_URL:https://localhost:4200/reset-password?token=}

INATrace.admin.email = ${INATRACE_ADMIN_EMAIL:admin@local.com}
INATrace.admin.password = ${INATRACE_ADMIN_PASSWORD:Admin123!}
INATrace.admin.name = ${INATRACE_ADMIN_NAME:Admin}
INATrace.admin.surname = ${INATRACE_ADMIN_SURNAME:Local Admin}
INATrace.admin.company.name = ${INATRACE_ADMIN_COMPANY_NAME:Local Company}

# prefix for FE
INATrace.fe.url = ${INATRACE_FE_URL:}

# Maxmind geoip database path (local path)
INATrace.maxmindDB.path = ${INATRACE_MAXMINDDB_PATH:}

# "Secret" token for logging request
INATrace.requestLog.token = ${INATRACE_REQUESTLOG_TOKEN:}

# Exchange rate API key
INAtrace.exchangerate.apiKey = ${INATRACE_EXCHANGERATE_APIKEY:}
INATrace.exchangerate.enabled = ${INATRACE_EXCHANGERATE_ENABLED:false}
INATrace.exchangerate.cacheTtlMinutes = ${INATRACE_EXCHANGERATE_CACHE_TTL:60}

# Beyco integration OAuth2 data
beyco.oauth2.clientId = ${BEYCO_OAUTH2_CLIENTID:}
beyco.oauth2.clientSecret = ${BEYCO_OAUTH2_CLIENTSECRET:}
beyco.oauth2.url = ${BEYCO_OAUTH2_URL:}

beyco.integration.url =

#AgStack integration
INATrace.agstack.authUrl = ${INATRACE_AGSTACK_AUTH_URL:https://user-registry.agstack.org}
INATrace.agstack.email = ${INATRACE_AGSTACK_EMAIL:}
INATrace.agstack.password = ${INATRACE_AGSTACK_PASSWORD:}
INATrace.agstack.baseURL  = ${INATRACE_AGSTACK_BASEURL:https://api-ar.agstack.org}

