# Test profile overrides for CI and local dev
INATrace.env = TEST

# DataSource
INATrace.database.name = ${INATrace_DB_NAME:inatrace_test}
INATrace.database.hostname = ${INATrace_DB_HOST:127.0.0.1}
INATrace.database.port = ${INATrace_DB_PORT:3306}

spring.datasource.url = jdbc:mysql://${INATrace.database.hostname}:${INATrace.database.port}/${INATrace.database.name}?autoReconnect=true&allowPublicKeyRetrieval=true&useSSL=false&serverTimezone=UTC
spring.datasource.username = ${INATrace_DB_USER:root}
spring.datasource.password = ${INATrace_DB_PASS:root}

# JPA/Flyway
spring.jpa.hibernate.ddl-auto = update
spring.jpa.properties.hibernate.hbm2ddl.auto = update
spring.jpa.autocommit = true
spring.jpa.hibernate.naming.implicit-strategy = org.hibernate.boot.model.naming.ImplicitNamingStrategyComponentPathImpl
spring.jpa.hibernate.naming.physical-strategy = org.hibernate.boot.model.naming.PhysicalNamingStrategyStandardImpl
spring.jpa.properties.hibernate.dialect = com.abelium.inatrace.configuration.CustomMySQLDialect

# Ensure Flyway runs on startup and tolerates out-of-order/ignored migrations in forks
spring.flyway.baseline-on-migrate = true
spring.flyway.out-of-order = true
spring.flyway.validate-on-migrate = false
spring.flyway.check-location = false
spring.flyway.table = schema_version
spring.flyway.ignore-missing-migrations = true
spring.flyway.locations = com.abelium.inatrace.db.migrations,classpath:/db/migrations

# Reduce noisy logging in CI
logging.level.org.hibernate.orm.query=WARN
logging.level.org.springframework=WARN
logging.level.com.abelium.inatrace=INFO

# Mail disabled in tests
INATrace.mail.sendingEnabled = false

# Misc required placeholders to avoid bean failures
INATrace.auth.jwtSigningKey = test-key
INATrace.documents.root = documents/
INATrace.fileStorage.root = inatrace_file_storage_path
